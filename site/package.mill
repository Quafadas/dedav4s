package build.site

import mill._
import mill.scalalib._
import mill.scalajslib._
import mill.scalajslib.api._
import io.github.quafadas.millSite.*

object `package` extends SiteModule {

  override lazy val jsSiteModule = Some(build.siteJs)

  override def unidocDeps = Seq(build.core.jvm, build.siteHelp)

  override def pathToImportMap = Task { Some(PathRef(Task.dest / os.up / os.up / os.up / os.up / "importmap.json")) }

  def scalaVersion = build.Config.scalaVersion
}


/*

<script>
    const sse = new EventSource("/refresh/v1/sse");
    sse.addEventListener("message", (e) => {
    const msg = JSON.parse(e.data);

    if ("KeepAlive" in msg) console.log("KeepAlive");

    if ("PageRefresh" in msg) location.reload();
    });
</script>

 */

//   def  liveServer = T{
//     val sitePath  = live()
//     os.proc(
//         "cs",
//         "launch",
//         "io.github.quafadas::sjsls:0.2.5",
//         "--",
//         "--path-to-index-html", (sitePath).toString(),
//         "--build-tool", "none",
//         "--browse-on-open-at", "/docs/index.html",
//         "--port", "8081"
//       ).call()
//   }
// }