<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Laika 0.18.1 + Helium Theme" />
    <title>Workflow</title>
    
      <meta name="author" content="Simon Parten"/>
    
    
      <meta name="description" content="Declarative data visualisation for scala"/>
    
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@1.207/distr/fira_code.css">
    
    <link rel="stylesheet" type="text/css" href="../helium/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/laika-helium.css" />
    <script src="../helium/laika-helium.js"></script>
    
    
    <script> /* for avoiding page load transitions */ </script>
  </head>

  <body>

    <header id="top-bar">

      <div class="row">
        <a id="nav-icon">
          <i class="icofont-laika" title="Navigation">&#xefa2;</i>
        </a>
        
      </div>
  
      <a class="icon-link" href="../index.html"><i class="icofont-laika" title="Home">&#xef47;</i></a>
      
      <span class="row links"><a class="icon-link" href="https://github.com/Quafadas/dedav4s"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a></span>
      
    </header>

    <nav id="sidebar">

      <div class="row">
        <a class="icon-link" href="https://github.com/Quafadas/dedav4s"><span title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
      </div>
      
      <ul class="nav-list">
        <li class="level1 nav-header">gettingStarted</li>
        <li class="level2"><a href="../gettingStarted/gettingStarted.html">Getting Started</a></li>
        <li class="level1 nav-header">Details</li>
        <li class="level2"><a href="plotTargets.html">Plot Targets</a></li>
        <li class="level2 active"><a href="#">Workflow</a></li>
        <li class="level2"><a href="customising.html">Customising an existing data structure</a></li>
        <li class="level2"><a href="outFiles.html">Where do the temporary files live?</a></li>
        <li class="level2"><a href="workingChart.html">Working with a chart</a></li>
        <li class="level2"><a href="rawDataTypes.html">&quot;Raw&quot; Data &amp; Extension Methods</a></li>
        <li class="level1 nav-header">Scala Versions</li>
        <li class="level2"><a href="../ScalaVersions/scalaVersions.html">Scala Versions</a></li>
        <li class="level1 nav-header">Prior Art</li>
        <li class="level2"><a href="../priorArt/philosophy.html">Prior Art</a></li>
      </ul>
      
    </nav>

    <div id="container">

      <nav id="page-nav">
        <p class="header"><a href="#">Workflow</a></p>
        
        <ul class="nav-list">
          <li class="level1"><a href="#suggested-workflow">Suggested Workflow</a></li>
          <li class="level1"><a href="#visualisation-as-json">Visualisation as JSON</a></li>
          <li class="level1"><a href="#some-concepts">Some Concepts</a></li>
          <li class="level1"><a href="#spec-customisation">&quot;Spec Customisation&quot;</a></li>
        </ul>
        
        <p class="footer"></p>
      </nav>

      <main class="content">

        <h1 id="workflow" class="title">Workflow</h1>
        <p>You need a <a href="plotTargets.html">plot target</a> in place, and then we&#39;re ready to plot some data. The idea of the library is to wrap vega by simply treating a chart spec as a JSON object.<br></p>
        <p>The library exposes the <a href="https://vega.github.io/vega/examples/">vega examples</a> and <a href="https://vega.github.io/vega-lite/examples/">vega lite examples</a> convieniently as case classes. The class names correspond to the title of the charts (with some special characters removed).</p>
        
        <h2 id="suggested-workflow" class="section">Suggested Workflow<a class="anchor-link right" href="#suggested-workflow"><i class="icofont-laika">&#xef71;</i></a></h2>
        <ol class="arabic">
          <li>Identify a plot which looks similar to your desired visualisation</li>
          <li>Customise it, by modifiying the JSON spec to be your desired visualisation</li>
        </ol>
        <p>As always... lean into vega;</p>
        <p><img src="../assets/vegaEditor.png" alt="The Vega Editor"></p>
        
        <h2 id="visualisation-as-json" class="section">Visualisation as JSON<a class="anchor-link right" href="#visualisation-as-json"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>We can easily manipulate JSON objects using <a href="https://www.lihaoyi.com/post/uJsonfastflexibleandintuitiveJSONforScala.html">ujson</a>. </p>
        <p>Ideas</p>
        <ol class="arabic">
          <li>Pipe &quot;raw&quot; data into a vega example</li>
          <li>Record a list of modifiers which were useful modifications to an example for re-use</li>
          <li>Spec has been modified enough that a list of modifiers is confusing. Extend the WithBaseSpec class directly via a file or resource (see &quot;Custom.scala&quot;). Then pipe data into it.</li>
          <li>In prod... don&#39;t use this library anymore - probably you have a webserver which means you already have javascript. Use vega directly, Keep the spec under version control and use vega data loading capabilities to talk to the API providing data. </li>
        </ol>
        
        <h2 id="some-concepts" class="section">Some Concepts<a class="anchor-link right" href="#some-concepts"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Each &quot;plot&quot; is a case class which accepts a list of &quot;modifiers&quot;. Each case class has the signature accepting a single argument of type; </p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Seq</span><span>[</span><span class="identifier">ujson</span><span>.</span><span class="type-name">Value</span><span> =&gt; </span><span class="type-name">Unit</span><span>] </span></code></pre>
        <p>i.e. a list of functions which modifiy a <code>ujson.Value</code>
        This signature appears often enough that it is aliased as;</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">JsonMod</span><span> = </span><span class="type-name">Seq</span><span>[</span><span class="identifier">ujson</span><span>.</span><span class="type-name">Value</span><span> =&gt; </span><span class="type-name">Unit</span><span>]</span></code></pre>
        <p>Upon creation, each of these functions is applied to a &quot;base spec&quot;. To start with, a base spec will be an example from the vega website). The signature of <code>viz.vega.plots.SimpleBarChart()</code> is</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">BarChart</span><span>(</span><span class="keyword">override</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">mods</span><span> : </span><span class="type-name">JsonMod</span><span>=</span><span class="type-name">List</span><span>())(</span><span class="identifier">using</span><span> </span><span class="type-name">PlotTarget</span><span>) </span><span class="keyword">extends</span><span> </span><span class="type-name">FromUrl</span><span>(</span><span class="type-name">SpecUrl</span><span>.</span><span class="type-name">BarChart</span><span>)</span></code></pre>
        <p>The constiuents of this definition are;
        - mods change the spec (to make it look the way you want - for example adding your own data)
        - PlotTarget is a side effect which is run when the case class is created. Often will display the plot in a browser.
        - The final part tells this case class, where to obtain a &quot;base specification&quot;. In this case, <a href="https://vega.github.io/vega/examples/bar-chart.vg.json">https://vega.github.io/vega/examples/bar-chart.vg.json</a></p>
        <p>What that means, is that to add a title, we need to <a href="https://vega.github.io/vega/docs/title/">read the vega docs</a>. To skip some steps, try...</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">SimpleBarChartLite</span><span>(</span><span class="type-name">List</span><span>(</span><span class="identifier">spec</span><span> =&gt; </span><span class="identifier">spec</span><span>(</span><span class="string-literal">&quot;title&quot;</span><span>) = </span><span class="string-literal">&quot;Got Viz?&quot;</span><span>))</span></code></pre>
        <p>We&#39;ll revisit this in more detail below. Crucially, to know <em>where</em> to add stuff to the spec, you&#39;re going to need the vega documentation. </p>
        <p><a href="https://vega.github.io/vega/docs/">Vega documentation</a></p>
        <p><a href="https://vega.github.io/vega-lite/docs/">Vega Lite documentation</a></p>
        <p>Finally, a small number of &quot;helpers&quot; appear often enough that they are honoured with an implementation in the library; </p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">SunburstDrag</span><span>(</span><span class="type-name">List</span><span>(</span><span class="identifier">viz</span><span>.</span><span class="type-name">Utils</span><span>.</span><span class="identifier">fillDiv</span><span>, </span><span class="identifier">viz</span><span>.</span><span class="type-name">Utils</span><span>.</span><span class="identifier">fixDefaultDataUrl</span><span>))</span></code></pre>
        
        <h2 id="spec-customisation" class="section">&quot;Spec Customisation&quot;<a class="anchor-link right" href="#spec-customisation"><i class="icofont-laika">&#xef71;</i></a></h2>
        <p>Is one level of abstraction deeper. </p>
        <p>The core promise of the library, is that it wraps Vega. It goes one further step, by making the &quot;examples&quot; on the vega website, easy to plot, and then customise.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">viz</span><span>.</span><span class="identifier">vega</span><span>.</span><span class="identifier">plots</span><span>.</span><span class="type-name">LineChartLite</span><span>(
    </span><span class="type-name">List</span><span>(
        </span><span class="identifier">viz</span><span>.</span><span class="type-name">Utils</span><span>.</span><span class="identifier">fixDefaultDataUrl</span><span>
    )
)
</span><span class="comment">// res1: LineChartLite = LineChartLite(mods = List(Fix default data url))</span></code></pre>
        <div id="mdoc-html-run0" data-mdoc-js></div>
        <p>As we&#39;ve changed the home of the chart (which no longer is on the vega lite examples homepage), we also need to adapt it&#39;s data url to point to the right place, else data loading will fail. It&#39;s not a bad excercise to allow that failure. </p>
        <p>This is our hint on how we&#39;re going to manage minor modifications to plots. </p>
        <p>Here, we have the line chart example from vega lite. <code>viz.vega.plots.xxx</code> contains <em>all</em> the examples on the vega, and vega-lite websites. vega-lite charts have &quot;lite&quot; appended.</p>
        <p>Someone was apparently crazy enough to implement pacman in vega. As &quot;proof&quot; that we really did <em>all</em> the examples, and for your gaming pleasure.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">viz</span><span>.</span><span class="identifier">vega</span><span>.</span><span class="identifier">plots</span><span>.</span><span class="type-name">Pacman</span><span>()
</span><span class="comment">// res3: Pacman = Pacman(mods = List())</span></code></pre>
        <div id="mdoc-html-run1" data-mdoc-js></div>
        <p>More seriously though, this library is targeted at &quot;work&quot;. </p>
        <p>We need a way to customise charts, which we&#39;ve hinted at above, by providing a list of &quot;modifiers&quot;. A very common customisation, is to want to display your own data (!), from the JVM / ammonite / scala runtime, in the chart. Conceptually this is no different from all the other modification we will make - just change the JSON object.
        <script crossorigin type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5"></script>
        <script crossorigin type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
        <script crossorigin type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script></p>
        <p><script type="text/javascript" src="workflow.md.js" defer></script>
        <script type="text/javascript" src="mdoc.js" defer></script></p>

      </main>

    </div>

  </body>
</html>